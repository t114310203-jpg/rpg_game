# 專案變更紀錄

## project.cpp 版本演進紀錄

**專案名稱**: 名偵探柯南：諾亞方舟防衛戰  
**當前版本**: 2.0.0  
**最後更新**: 2025年12月27日  
**開發狀態**: 穩定版本

---

## 📋 版本總覽

| 版本 | 日期 | 重點更新 | 狀態 |
|------|------|----------|------|
| 2.0.0 | 2025-12-27 | 文檔完善、流程圖與類別圖補充 | ✅ 當前版本 |
| 1.5.0 | 2025-12-26 | 完整遊戲系統、8章劇情 | ✅ 穩定 |
| 1.0.0 | 2025-12-25 | 初始版本、核心戰鬥系統 | ✅ 里程碑 |

---

## 🎯 Version 2.0.0 (2025-12-27)

### 📚 文檔系統建立

#### 新增檔案
- ✨ `README.md` - 完整遊戲說明文檔
  - 遊戲簡介與特色
  - 角色職業完整數據表
  - 遊戲系統詳解
  - 編譯與執行指南
  - 操作說明與攻略建議
  - 技術細節文檔
  
- ✨ `113-11_ClassDiagram.md` - 類別圖文檔
  - Mermaid 完整類別圖
  - 包含繼承、組合、聚合關係
  - 列舉類型定義
  
- ✨ `113-11_ClassDiagram_PlantUML.md` - PlantUML 版本類別圖
  - 跨平台相容性
  - 專業 UML 標準格式
  
- ✨ `113-11_ClassDiagram_Split.md` - 分拆類別圖
  - 戰鬥系統圖
  - 道具與技能系統圖
  - 劇情狀態與地點系統圖
  
- ✨ `113-11_flowchart.md` - 流程圖文檔
  - 應用主流程圖
  - 戰鬥系統詳細流程
  - 商店系統流程
  - 隊伍管理流程
  - 搜查與隨機事件流程

#### 文檔優化
- 📝 統一中文繁體與術語
- 📝 新增表格與視覺化呈現
- 📝 補充跨平台編譯指令
- 📝 完善記憶體管理說明
- 📝 新增設計模式文檔

### 🐛 修正與優化
- 🔧 修正 Mermaid 語法錯誤（括號與斜線解析問題）
- 🔧 統一檔案編碼為 UTF-8
- 🔧 補充程式碼註解完整性

---

## 🎮 Version 1.5.0 (2025-12-26)

### 主要功能

#### 🎭 完整角色系統
- **4 大職業**
  - Gadgeteer（道具專家）：江戶川柯南
  - Fighter（格鬥家）：毛利蘭、服部平次、京極真、赤井秀一、安室透、遠山和葉
  - Support（後勤）：灰原哀、阿笠博士、鈴木園子、工藤優作
  - Trickster（特殊）：怪盜基德、毛利小五郎、工藤有希子

- **角色特色語音系統**
  - 攻擊語音
  - 技能施放語音
  - 勝利語音
  - 13 名角色獨特台詞

#### ⚔️ 戰鬥系統完善
```cpp
// 核心機制
- 回合制戰鬥
- 技能冷卻機制（CD 1-4 回合）
- 爆擊系統（幸運值判定，1.5x 傷害）
- 閃避系統（速度值判定）
- BOSS 削弱機制（線索消耗）
```

#### 🗺️ 地點探索系統
```cpp
// 7 個獨特地點
Location LOCATIONS[] = {
    {0, "警視廳", 0.8x敵人, 0.8x金錢, +30%調查, Ch.0},
    {1, "阿笠博士家", 1.0x, 1.0x, +20%, Ch.0},
    {2, "太平洋巡邏艦", 1.2x, 1.2x, +10%, Ch.2},
    {3, "五稜星大廳", 1.4x, 1.5x, +5%, Ch.3},
    {4, "中央控制室", 1.6x, 1.8x, 0%, Ch.4},
    {5, "地下維修通道", 1.8x, 2.0x, -10%, Ch.5},
    {6, "水下伺服器室", 2.2x, 2.5x, -5%, Ch.6},
    {7, "外部水域", 3.0x, 5.0x, +10%, Ch.7}
};
```

#### 📜 8 章完整劇情
```cpp
namespace Story {
    Ch.0: 序章 - 警視廳的暗流
    Ch.1: 鈴木財團的邀請函
    Ch.2: 駛向太平洋
    Ch.3: 諾亞方舟的凝視（基爾 BOSS）
    Ch.4: 黑衣的入侵者（苦艾酒 BOSS）
    Ch.5: 伺服器過熱（伏特加 BOSS）
    Ch.6: 伺服器攻防戰（琴酒 BOSS）
    Ch.7: 深海的逆轉
    Ch.8: 終章 - 黎明前的五稜星
}
```

#### 💰 經濟與道具系統
```cpp
// 商店系統
shopItems[] = {
    波羅麵包（100円，+50 HP）
    鰻魚飯（300円，+100 HP）
    阿笠博士特製藥（500円，+200 HP）
    急救箱（600円，復活 + 50% HP）
};

// 背包系統
struct InventorySlot {
    Item* item;
    int count;  // 堆疊數量
};
```

#### 🎲 隨機事件系統
```cpp
void triggerRandomEvent() {
    // 40% 觸發機率
    - SHARK: 海域鯊魚觀察
    - SYSTEM_ERROR: 系統防火牆事件
    - LUNCH: 元太肚子餓（-30円）
    - RAN_KARATE: 小蘭空手道（+1線索）
    - AGASA_QUIZ: 博士猜謎（全員+50 HP）
}
```

#### 🔍 搜查系統
```cpp
void investigate() {
    // 成功率 = 50% + 地點加成
    成功 → +1~2 線索
    失敗 → 一無所獲
    特殊 → 5% 機率遇見新夥伴
}
```

### 技術架構

#### 設計模式應用
```cpp
// 繼承與多型
Character ← Gadgeteer/Fighter/Support/Trickster

// 策略模式
Skill ← AttackSkill/HealSkill

// 組合模式
Character *-- Skill[]

// 工廠模式
Character* createRandomNPC()
```

#### 記憶體管理
```cpp
// 完整生命週期管理
void resetGame() {
    // 清理舊資料
    for(auto* c : team) delete c;
    for(auto* c : reserve) delete c;
    for(auto* i : shopItems) delete i;
    
    // 重新初始化
    team.clear();
    reserve.clear();
    inventory.clear();
}
```

---

## 🏁 Version 1.0.0 (2025-12-25)

### 核心功能建立

#### 基礎系統
- ✅ Character 抽象基類
- ✅ 基本戰鬥迴圈
- ✅ 3 種職業原型（戰士/法師/盜賊風格）
- ✅ Monster 類別與生成邏輯
- ✅ 簡易經驗值系統

#### 輔助工具
```cpp
namespace Color {
    // ANSI 顏色代碼
    RESET, BOLD, GRAY, RED, GREEN, 
    YELLOW, BLUE, MAGENTA, CYAN, WHITE
}

// 工具函式
getRandom(min, max)        // 真隨機數
wait(ms)                   // 延遲
clearInput()               // 輸入清理
getValidInput(min, max)    // 安全輸入
printMessage(text, name)   // 對話系統
```

#### 戰鬥機制
```cpp
void battle(team, monster) {
    while (monster.hp > 0) {
        // 玩家回合
        for (member : team) {
            選擇行動 → 計算傷害 → 套用
        }
        
        // 怪物回合
        if (team有人存活) {
            隨機攻擊目標
            閃避判定
        }
        
        // 勝敗判定
        if (怪物死亡) 勝利
        if (全員陣亡) 失敗
    }
}
```

---

## 📊 技術統計

### 程式碼規模
```
總行數: 1,277 行
- 註解與空行: ~200 行
- 類別定義: ~400 行
- 遊戲邏輯: ~500 行
- 劇情系統: ~177 行
```

### 類別結構
```
抽象基類: 3 個（Character, Skill, Item）
具體類別: 14 個
列舉類型: 2 個（MonsterType, StatType）
結構體: 3 個（GameState, Location, InventorySlot）
```

### 功能模組
```
✅ 角色系統（4職業 13角色）
✅ 技能系統（冷卻、類型、效果）
✅ 道具系統（恢復、復活）
✅ 戰鬥系統（回合制、爆擊、閃避）
✅ 商店系統（購買、背包管理）
✅ 地點系統（7地點、屬性修正）
✅ 劇情系統（8章節、BOSS觸發）
✅ 隊伍系統（出戰/待命、替換）
✅ 搜查系統（線索、夥伴招募）
✅ 事件系統（隨機觸發）
✅ 儲存系統（重新開始）
```

---

## 🔮 未來規劃 (v3.0+)

### 可能的擴充方向
- [ ] 存檔/讀檔系統
- [ ] 多結局分支
- [ ] 角色好感度系統
- [ ] 更多隱藏角色（怪盜基德、赤井瑪麗等）
- [ ] 難度選擇（簡單/普通/困難）
- [ ] 成就系統
- [ ] 裝備系統
- [ ] 被動技能
- [ ] 組合技（雙人技能）
- [ ] 圖形化界面（GUI）

---

## 🐛 已知問題

### 當前版本 (v2.0.0)
- Windows 控制台需執行 `chcp 65001` 顯示 UTF-8
- 部分終端機不支援 ANSI 顏色
- 戰鬥全滅後無法復活（直接重新開始）
- 無存檔系統（一次遊戲session）

### 已修復問題
- ✅ v1.5: 修正技能冷卻未正確倒數
- ✅ v1.5: 修正怪物攻擊目標為空指標
- ✅ v1.5: 修正經驗值溢位導致負數等級
- ✅ v2.0: 修正 Mermaid 圖表語法錯誤

---

## 📝 開發備註

### 設計理念
1. **物件導向**：充分利用繼承與多型
2. **可擴充性**：模組化設計，易於新增角色/技能
3. **使用者體驗**：顏色、延遲、對話增強沉浸感
4. **平衡性**：職業、技能、敵人強度經過調整

### 技術選擇
- **語言**: C++11（相容性廣）
- **STL**: vector、string、algorithm
- **隨機數**: mt19937（高品質隨機）
- **延遲**: chrono + thread（跨平台）

### 授權資訊
- 專案性質：教學/展示用途
- 角色版權：名偵探柯南 © 青山剛昌
- 程式碼：開放原始碼（教育用途）

---

**最後更新**: 2025年12月27日  
**維護者**: [您的名稱]  
**專案狀態**: ✅ 穩定可玩

// 狀態存取
int getSpeed() const;
bool getIsPlayer() const;
int getTempBuff() const;

// 增益管理
void addBuff(int val);
void clearBuff();

// 技能管理
void addSkill(Skill* skill);
const vector<Skill*>& getSkills() const;
void tickCooldowns();
void resetCooldowns();

// 技能執行
int performSkill(int skillIdx, vector<Character*>& team);
int useRandomSkill(vector<Character*>& team);

// 台詞系統
virtual string getQuote(string action);
```

#### 建構子變更
```cpp
// 原版
Character(string n, int lv, int h, int po, int kn, int lu);

// 新版
Character(string n, string cls, int lv, int h, int po, int kn, int lu, bool isPly = false);
//                  🆕 職業                                            🆕 是否玩家
```

#### 解構子改進
```cpp
// 原版: 無解構子

// 新版: 正確清理記憶體
virtual ~Character() {
    for (Skill* s : skills) delete s;
    skills.clear();
}
```

### 職業類別完全重構

#### 原版職業 (已移除)
- `Warrior` (戰士)
- `Wizard` (法師)
- `Rogue` (盜賊)

#### 新版職業 (柯南主題)

**1. Gadgeteer (名偵探) - 玩家專用**
```cpp
class Gadgeteer : public Character {
    Gadgeteer(string n, int lv=1) : Character(n, "名偵探", lv, ...);
    // 屬性成長: HP 60, 力量 5, 知識 12, 幸運 8
    // 技能:
    // - 腳力增強鞋 (混合技能, CD 2)
    // - 麻醉手錶 (智力攻擊 1.5x + 20, CD 4)
    // - 蝴蝶結變聲器 (智力攻擊 1.2x, CD 3)
};
```

**2. Fighter (格鬥家)**
```cpp
class Fighter : public Character {
    // 屬性成長: HP 100, 力量 10, 知識 3, 幸運 5
    // 子類型:
    // - Karate (毛利蘭): 空手道劈擊, 迴旋踢
    // - Kendo (服部平次): 劍道突刺, 居合斬
    // - Super (京極真): 正拳突刺 (3.0x), 迴旋踢
};
```

**3. Support (後勤)**
```cpp
class Support : public Character {
    // 屬性成長: HP 50, 力量 3, 知識 15, 幸運 6
    // 子類型:
    // - Science (灰原哀): APTX解藥, 化學炸彈
    // - Inventor (阿笠博士): 冷謎語, APTX解藥
    // - Rich (鈴木園子): 鈔能力, APTX解藥 (+20 幸運)
};
```

**4. Trickster (特殊)**
```cpp
class Trickster : public Character {
    // 屬性成長: HP 80, 力量 6, 知識 8, 幸運 15
    // 子類型:
    // - Thief (怪盜基德): 撲克牌槍, 化學炸彈
    // - Sleep (毛利小五郎): 過肩摔, 沉睡推理
};
```

### Monster 類別改進

#### 新增成員
```cpp
int maxHp;              // 🆕 最大血量 (用於 UI 顯示)
int moneyDrop;          // 🆕 金錢掉落
MonsterType type;       // 保留
```

#### 建構子變更
```cpp
// 原版
Monster(string n, int h, int a, MonsterType t);

// 新版
Monster(string n, int h, int a, MonsterType t, int money);
//                                              🆕 金錢掉落
```

#### 怪物生成邏輯完全重寫
**原版**: 簡單的隨機怪物 (哥布林/狼人/食人魔)  
**新版**: 動態平衡 + 劇情 BOSS

```cpp
Monster generateMonster(const vector<Character*>& team) {
    // 1. 計算隊伍總戰力
    // 2. 根據當前地點調整倍率
    // 3. 檢查 BOSS 旗標
    // 4. 章節 BOSS 優先生成
    // 5. 隨機生成普通/菁英怪
}
```

**BOSS 列表**:
- 基安蒂 (Chianti) - 2.0x HP, 1.5x ATK
- 苦艾酒 (Vermouth) - 2.5x HP, 1.4x ATK
- 伏特加 (Vodka) - 3.0x HP, 1.3x ATK
- 愛爾蘭 (Irish) - 3.5x HP, 1.6x ATK
- 朗姆 (Rum) - 4.0x HP, 1.8x ATK
- 琴酒 (Gin) - 5.0x HP, 2.0x ATK (最終 BOSS)

---

## ⚙️ 遊戲機制改進

### 戰鬥系統升級

#### 1. 戰鬥流程
**原版**: 玩家輪流攻擊 → 怪物群攻  
**新版**: 回合制 + 智能 AI + UI 優化

```
每回合:
┌─ 顯示戰鬥狀態 (HP 條、Buff 顯示)
├─ 玩家回合
│  ├─ 選擇: 普攻 / 技能 / 道具
│  ├─ 技能冷卻檢查
│  ├─ 傷害計算 + 爆擊判定
│  └─ BOSS 防禦減半 (未推理)
├─ NPC 回合 (30% 使用技能)
├─ 怪物回合
│  ├─ 單體攻擊 (閃避判定)
│  └─ BOSS 二次攻擊
├─ 冷卻時間遞減
└─ 存活檢查
```

#### 2. BOSS 推理機制 (🆕)
```cpp
if (gState.playerClues >= 5) {
    // 推理成功: 消耗 5 線索
    // BOSS 破綻暴露，傷害正常
} else {
    // 推理失敗:
    // - BOSS 1.5x HP
    // - BOSS 1.5x ATK
    // - 玩家傷害減半
}
```

#### 3. 傷害計算改進
```cpp
// 原版: 固定公式 (power * 2)
damage = power * 2;

// 新版: 隨機波動 + 爆擊
int baseDamage = (ATK * multiplier + bonus);
damage = getRandom(baseDamage * 0.8, baseDamage * 1.2);
if (getRandom(1, 100) <= luck) {
    damage *= 1.5;  // 爆擊!
}
```

#### 4. 戰鬥 UI 改進
**新增功能**:
- HP 條視覺化 (20 格進度條)
- 彩色狀態顯示
- Buff 效果提示
- 技能冷卻倒數顯示
- BOSS 開場白
- 角色勝利台詞

```
══════════════════════════════════════════════════
【敵方】 琴酒 (Gin)
  HP: [############        ] 600/1000 (ATK: 80)

【我方】
  江戶川柯南 HP: 240/300 (Buff+10)
  毛利蘭 HP: 450/500
  灰原哀 HP: 200/250
══════════════════════════════════════════════════
```

### 角色台詞系統 (🆕)

每個角色都有個性化台詞:
```cpp
string getQuote(string action) override {
    if (action == "ATTACK") return "可惡... 看招！";
    if (action == "SKILL") return "去吧！這是我的王牌！";
    if (action == "WIN") return "真相永遠只有一個！";
}
```

**實裝角色台詞**:
- 江戶川柯南
- 毛利蘭
- 服部平次
- 京極真
- 灰原哀
- 阿笠博士
- 怪盜基德
- 毛利小五郎

### 經驗值與升級
**保持不變**: 公式相同，但視覺效果優化
```cpp
// 升級提示改進
cout << Color::GREEN << Color::BOLD 
     << ">>> " << name << " 升級了！ (Lv." << level << ")" 
     << Color::RESET;
```

---

## 📝 詳細變更清單

### 引入函式庫變更

#### 新增
```cpp
#include <string>    // 🆕 字串處理
#include <thread>    // 🆕 延遲效果
#include <chrono>    // 🆕 時間相關
```

#### 移除
```cpp
#include <cstdlib>   // ❌ (改用 <random>)
#include <ctime>     // ❌ (改用 <random>)
```

### 核心邏輯變更

#### 主程式流程對比

**原版 main()**: 
```
1. 創建 3 個角色 (手動輸入)
2. 無限戰鬥循環
3. 擊敗怪物 → 詢問繼續
```

**新版 main()**:
```
1. 初始化系統 (商店、顏色、編碼)
2. 播放開場劇情
3. 自動組隊 (柯南 + 3 個隨機 NPC)
4. 發放初始道具
5. 主選單循環:
   - 搜尋敵人 (戰鬥)
   - 移動地點
   - 商店購物
   - 隊伍管理
   - 搜查線索
6. 章節推進與劇情觸發
7. 結束後記憶體清理
```

### 輸入驗證改進

**原版**: 無驗證，易崩潰
```cpp
cin >> choice;  // 輸入錯誤會導致無限循環
```

**新版**: 完整驗證
```cpp
int getValidInput(int min, int max, string prompt, string color) {
    while (true) {
        if (cin >> choice && choice >= min && choice <= max) {
            clearInput();
            return choice;
        }
        cin.clear();
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
    }
}
```

### 記憶體管理改進

**原版**: 基本清理
```cpp
for (size_t i = 0; i < team.size(); ++i) {
    delete team[i];
}
```

**新版**: 完整清理
```cpp
for(auto* c : team) delete c;
for(auto* c : reserve) delete c;     // 🆕 待命區
for(auto* i : shopItems) delete i;   // 🆕 商店物品
// 技能記憶體由 Character 解構子自動清理
```

### 隨機數生成改進

**原版**: 偽隨機 (可預測)
```cpp
srand(time(0));
int value = rand() % max;
```

**新版**: 真隨機 (Mersenne Twister)
```cpp
inline int getRandom(int min, int max) {
    static random_device rd;
    static mt19937 gen(rd());
    uniform_int_distribution<> distrib(min, max);
    return distrib(gen);
}
```

---

## 📊 代碼品質提升

### 可維護性
- ✅ 模組化設計 (輔助函式、命名空間)
- ✅ 常數定義 (Color, MAX_TEAM_SIZE, EXP_LV)
- ✅ 工廠模式 (`createRandomNPC()`)
- ✅ 策略模式 (Skill 繼承體系)

### 可擴展性
- ✅ 地點系統易於新增
- ✅ 角色類別易於擴充
- ✅ 技能系統開放封閉原則
- ✅ 劇情系統模組化

### 用戶體驗
- ✅ 彩色輸出
- ✅ 動畫效果 (延遲、打字機)
- ✅ 錯誤處理
- ✅ 進度提示
- ✅ 視覺化 HP 條

### 遊戲平衡
- ✅ 動態難度調整
- ✅ 地點難度倍率
- ✅ BOSS 推理機制
- ✅ 技能冷卻平衡

---

## 🎯 功能對比總表

| 功能 | 113-11.cpp | project.cpp | 改進程度 |
|------|-----------|-------------|----------|
| 角色職業 | 3 種通用 | 4 種 + 10 個特定角色 | ⭐⭐⭐⭐⭐ |
| 技能系統 | 字串列表 | 物件導向 + CD | ⭐⭐⭐⭐⭐ |
| 怪物系統 | 隨機 3 種 | 動態平衡 + 7 BOSS | ⭐⭐⭐⭐⭐ |
| 戰鬥系統 | 基礎回合 | 完整 RPG 戰鬥 | ⭐⭐⭐⭐⭐ |
| 道具系統 | 無 | 商店 + 背包 | ⭐⭐⭐⭐⭐ |
| 劇情系統 | 無 | 7 章劇情 | ⭐⭐⭐⭐⭐ |
| 地點探索 | 無 | 8 個地點 | ⭐⭐⭐⭐⭐ |
| 隊伍管理 | 固定 3 人 | 4 人出戰 + 待命 | ⭐⭐⭐⭐ |
| 搜查系統 | 無 | 線索收集 | ⭐⭐⭐⭐⭐ |
| 隨機事件 | 無 | 4 種事件 | ⭐⭐⭐⭐ |
| UI/UX | 純文字 | 彩色動畫 | ⭐⭐⭐⭐⭐ |
| 記憶體管理 | 基礎 | 完整清理 | ⭐⭐⭐⭐ |
| 輸入驗證 | 無 | 完整驗證 | ⭐⭐⭐⭐⭐ |

---

## 🔧 技術債務改進

### 原版問題
1. ❌ 無輸入錯誤處理 (輸入字母會崩潰)
2. ❌ 使用過時的 `rand()` (不安全)
3. ❌ 硬編碼技能邏輯 (if-else 地獄)
4. ❌ 無記憶體洩漏保護 (Skill 指標)
5. ❌ 魔術數字 (100, 80, 50)

### 新版解決方案
1. ✅ `getValidInput()` 完整驗證
2. ✅ `mt19937` 真隨機生成器
3. ✅ Skill 繼承體系 (多型)
4. ✅ Character 解構子自動清理
5. ✅ 常數定義 (EXP_LV, HP_LV, etc.)

---

## 📈 性能與可讀性

### 代碼可讀性
- **原版**: 功能混雜在一起
- **新版**: 
  - 清晰的區塊註解 (========)
  - 命名空間分隔 (Color, Story)
  - 一致的命名規範

### 執行效率
- ⚡ `inline` 關鍵字優化小函式
- ⚡ `const` 修飾符減少複製
- ⚡ `static` 隨機數生成器 (單例)
- ⚡ 引用傳遞 (`vector<Character*>&`)

---

## 🎮 遊戲流程對比

### 原版遊戲流程
```
開始
 ↓
輸入 3 個角色名稱與職業
 ↓
生成怪物
 ↓
戰鬥 (輪流攻擊)
 ↓
擊敗 → 獲得經驗 → 繼續？
 ↓
結束
```

### 新版遊戲流程
```
開始
 ↓
諾亞方舟開場劇情
 ↓
自動組隊 (柯南 + 3 NPC)
 ↓
第一章：米花町的陰影
 ↓
主選單循環
├─ 搜尋敵人 (戰鬥賺錢)
├─ 移動地點 (觸發事件)
├─ 商店購物 (道具補給)
├─ 隊伍管理 (替換成員)
└─ 搜查線索 (推進劇情)
 ↓
收集 3 線索 → 觸發第二章
 ↓
前往鈴木大博物館
 ↓
擊敗基安蒂 (BOSS1)
 ↓
第三章解鎖...
 ↓
...重複至第七章...
 ↓
最終決戰：熱帶樂園 vs 琴酒
 ↓
通關劇情
 ↓
Endless Mode / 結束
```

---

## 🎨 視覺效果範例

### 原版輸出
```
戰鬥開始！
產生的怪物: 哥布林 血量: 126, 攻擊力: 14, 類型: 普通怪物
玩家1 回合：
1. 普通攻擊
2. 使用技能
選擇: 1
玩家1 對 哥布林 造成 10 點傷害！
```

### 新版輸出
```
[青色打字機效果] 戰鬥開始...

══════════════════════════════════════════════════
【敵方】 基安蒂 (Chianti)
  HP: [####################] 800/800 (ATK: 60)

【我方】
  江戶川柯南 HP: 240/300 (Buff+10)
  毛利蘭 HP: 500/500
  灰原哀 HP: 250/250
══════════════════════════════════════════════════

--- Round 1 ---
輪到 江戶川柯南
1. 普通攻擊
2. 技能: 腳力增強鞋 (CD:2)
3. 技能: 麻醉手錶 (CD:4)
4. 技能: 蝴蝶結變聲器 (CD:3)
5. 使用道具
>> 請選擇: 2

【柯南】: 去吧！這是我的王牌！
[紫色打字機效果] 江戶川柯南 使用了技能：腳力增強鞋！
發動了混合屬性的強力攻擊！
CRITICAL HIT! 爆擊！
對 基安蒂 (Chianti) 造成了 72 點傷害！
```

---

## 📦 新增資料結構

### 背包系統
```cpp
struct InventorySlot {
    Item* item;
    int count;
};
vector<InventorySlot> inventory;
```

### 地點常數表
```cpp
const vector<Location> LOCATIONS = {
    // id, 名稱, 描述, 敵人倍率, 金錢倍率, 搜查加成, 解鎖章節
    {0, "米花町街道", "和平的街道", 1.0, 1.0, 10, 1},
    {1, "米花公園", "適合散步", 1.2, 1.2, 0, 1},
    ...
};
```

---

## 🐛 BUG 修復

### 原版 BUG
1. **輸入錯誤崩潰**: 輸入非數字會導致無限循環
2. **記憶體洩漏**: 技能字串無法正確清理
3. **除零風險**: `aliveCount` 可能為 0
4. **隨機數弱點**: `rand()` 可預測

### 新版修復
1. ✅ `getValidInput()` 完整驗證
2. ✅ Character 解構子清理 Skill 指標
3. ✅ 所有除法前檢查 (if aliveCount > 0)
4. ✅ `mt19937` 加密級隨機

---

## 🚀 未來擴展建議

基於當前架構，可輕鬆擴展:

1. **新角色**: 繼承 Character 類別
2. **新技能**: 繼承 Skill 類別
3. **新地點**: 新增至 LOCATIONS 向量
4. **新章節**: Story 命名空間新增函式
5. **成就系統**: 追蹤遊戲統計
6. **存檔系統**: 序列化 GameState
7. **多周目**: Boss Rush 模式
8. **難度選擇**: 調整 enemyStatMod

---

## 📚 學習價值

此重構展示了以下軟體工程概念:

1. **物件導向設計**
   - 繼承與多型 (Skill, Item, Character)
   - 封裝 (private, protected, public)
   - 抽象類別 (純虛擬函數)

2. **設計模式**
   - 工廠模式 (createRandomNPC)
   - 策略模式 (Skill 子類別)
   - 命名空間 (Color, Story)

3. **現代 C++**
   - `<random>` 真隨機
   - `auto` 類型推導
   - Lambda 表達式
   - Range-based for 循環

4. **遊戲設計**
   - 回合制戰鬥
   - 冷卻時間機制
   - 動態難度調整
   - 劇情驅動設計

---

## 📝 總結

這次重構將一個 **500 行的基礎 RPG** 升級為 **1277 行的完整遊戲系統**，展現了:

- ✅ **770 行新代碼** (+152%)
- ✅ **12 個全新系統**
- ✅ **17+ 個新類別**
- ✅ **7 章劇情內容**
- ✅ **10+ 個可玩角色**
- ✅ **完整的遊戲循環**

從代碼品質到遊戲性，全方位的專業級升級！

---

**文件結束**  

